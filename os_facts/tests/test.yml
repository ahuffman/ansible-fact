---
- name: "Initiate tests"
  hosts: "localhost"
  gather_facts: False
  tasks:
    - debug:
        msg: "Initiating test playbook runs"

    # Dynamic test role locatator to avoid manual test playbook builds later
    - name: "Locate test roles"
      find:
        paths:
          - "../roles"
        recurse: False
        file_type: "directory"
      register: "test_roles"

    - name: "Set test roles list"
      set_fact:
        testing_roles: "{{ test_roles.files | json_query('[*].path') }}"

    - name: "Output discovered testing roles"
      debug:
        var: "testing_roles"

# instantiate tests from dynamically discovered roles
- name: "Run ansible-fact tests"
  hosts: "localhost"
  gather_facts: False
  force_handlers: True
  collections:
    - "ansible_fact.os_facts"
  tasks:
    - debug:
        var: "{{ item | dirname }}"
      with_items: "{{ testing_roles }}"

    - name: "Include testing roles"
      include_role:
        name: "{{ item | dirname }}"
      with_items: "{{ testing_roles }}"

# - name: "cron_facts"
#   import_playbook: "cron_facts.yml"
#
# - name: "package_repository_facts"
#   import_playbook: "package_repository_facts.yml"
#
# - name: "process_facts"
#   import_playbook: "process_facts.yml"
#
# - name: "sudoers_facts"
#   import_playbook: "sudoers_facts.yml"
#
# - name: "user_group_facts"
#   import_playbook: "user_group_facts.yml"
